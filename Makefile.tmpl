# -*- Makefile -*- 
.POSIX:
CC=gcc
CDEFS=
COPT=-O3 -fstrict-aliasing
CWARN=-Wall -W
CINC=-I. -Ii386

CDBG=
CFLAGS=`sh oscflags.sh` $(COPT) $(CWARN) $(CDBG) $(CDEFS) $(CINC) $(XCF)

OBJS=rt.o util.o crt.o main.o salloc.o vers.o ra.o umc.o i386/co.o
umx: $(OBJS)
	$(CC) $(CFLAGS) $(LFLAGS) $(OBJS) `sh oslflags.sh` -o umx

clean:
	-rm -f umx $(OBJS)

force: clean
	$(MAKE) umx

.c.o:
	$(CC) $(CFLAGS) -c $< -o $@

CS=$(OBJS:.o=.c)
Makefile: Makefile.tmpl $(CS)
	@echo '### AUTOGENERATED; DO NOT EDIT ###' > $@
	cat Makefile.tmpl >> $@
	$(MAKE) -f Makefile.tmpl _depend
_depend:
	@gcc -MM $(CDEFS) $(CINC) $(CS) >> Makefile
###END###
